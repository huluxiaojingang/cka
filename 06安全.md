# Security 12%
- Know how to configure authentication and authorization
- Understand Kubernetes security primitives
- Know to configure network policies
- Create and manage TLS certificates for cluster components
- Work with images securely
- Define security contexts
- Secure persistent key value store

访问API Server需要经过 Authentication，Authorization，Admission Control 三步，API Server插件化安装。文档地址在reference菜单下 Accessing the API
普通用户访问API Server需要证书、token、用户名密码。Pod访问需要ServiceAccount


## Authentication 认证

  验证用户身份是否合法

三种客户端访问API Server认证方式
├── 证书+私钥
├── Token
├── 用户名密码


## Authorization 授权

  对集群资源的访问控制，k8s授权处理以下的请求属性
- user,group,extra
- API,请求方法（如get,post,update,patch,delete）和请求路径(如/api)
- 请求资源和子资源
- Namespace
- API Group
 
### 授权策略
  ABAC，基于属性的访问控制，修改策略后需要重启API Server，不推荐。文件内容是一个`Policy`对象的JSON串
  
  RABC，基于角色的访问控制。可以动态配置。
  - Role ，ClusterRole。角色表示一组权限的规则。Role适用带namespace的资源如Pod，ClusterRole适用集群资源如Node
  - RoleBinding，ClusterRoleBinding。用于与角色的对应关系。角色绑定包含一组相关主体以及被授予角色的引用

```
# create role
kubectl create role -h
kubectl create role pod-reader --verb=get,list,watch --resource=pods
 
# create clusterrole ,clusterrole没有namespace
kubectl create clusterrole -h
kubectl create clusterrole secret-reader --verb=get,list,watch --resource=secrets

# create rolebinding
kubectl create rolebinding -h
kubectl create rolebinding read-pods --role=pod-reader --user=jane

# create clusterrolebinding
kubectl create clusterrolebinding -h
kubectl create clusterrolebinding read-secrets-gloabl --clusterrole=secret-reader --group=manager
```
    
## Admission Control
  发送到API Server请求都要经过插件检查。会自动修改Pod。官网插件+自定义插件。
  
# Secret
 作为volumes挂载到容器内
```
apiVersion: v1
kind: Pod
metadata:
  name: secret-volumes-test
spec:
  containers:
  - name: secret-volumes-test
    image: nginx
    volumeMounts:
    - name: foo
      mountPath: /etc/config
      readOnly: true
  volumes:
  - name: foo
    secret:
      secretName: mysecret

```

 设置为环境变量
```
apiVersion: v1
kind: Pod
metadata:
  name: secret-env-test
spec:
  containers:
  - name: secret-env-test
    image: nginx
    env:
    - name: USER_NAME_SECRET
      valueFrom:
        secretKeyRef:
          name: mysecret
          key: username
    - name: PASSWORD_SECRET
      valueFrom:
        secretKeyRef:
          name: mysecret
          key: password
```

imagePullSecret
  
  
  
  
  
  
  
  
  
  
  
