# troubleshooting 10%

E2E测试用例跑在namespace下，可以describe namespace看下事件。猜测下一下哪个组件可能出问题了
apiserver
controller-manager
scheduler
node

系统组件是Static Pod，看下各个进程是不是都在。manifest路径可以查看ps -ef | grep kubelet 启动参数里找--config=xxx.conf
找到staticPodPath，进入这个路径，系统组件应该有 

etcd.yaml
kube-apiserver.yaml

kube-controller-manager.yaml

scheduler.yaml

看看是不是都在。修改过程就是把Static Pod的文件再放回这个目录

跑用例 
k8s集群
go编译环境
执行用例的配置参数
问题定位namespace events ，node events，pod events


# E2E 测试及结果分析
- 环境准备
- E3E配置用例选择。集群地址 --host 筛选用例 --ginkgo.ship --kinkgo.focus
- 问题定位。 namespace  event信息。节点状态及event信息。pod状态及event信息

# 管理面异常排查

## apiserver，etcd异常
- 无法创建，更新，删除资源对象
- 节点正常工作
- 已有资源对象正常工作，不受影响

## controller-manager异常
- deployment，rs，ds等对象操作请求处理正常，但是实际上未生效。意味着客户端的操作请求出去了，apiserver返回了成功的响应。但是实际上没效果。操作是异步的
- service关联的后端pod变化，单endpoint不更新
- ...

## seheduler异常
- pod长时间pending，且无调度失败event信息

## 排查方式
- master主键状态差查询 kubectl get cs
- 进程不存在。明确组件声明周期管理方式。故障检测方式是否有效（livenessProbe，restartPolicy）。重新启动进程。systemd还是Static Pod
- 进程crash。分析日志
- 组件功能异常。分析日志，检查依赖组件是否正常












