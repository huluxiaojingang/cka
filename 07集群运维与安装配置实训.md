# Instalation,Configuration &Validation 12%

# install master

## Master节点
- etct
- kube-apiserver
- kube-controller-manager
- kube-scheduler
- ...

开始尝试virtualBox Ubuntu虚拟机部署，但是遇到一些奇怪的问题，最终放弃了采用阿里云两台ECS机器。

  
1、install docker
```
apt-get update
apt-get install -y docker.io
```

2、install kubelet kubeadm kubelet
```
关闭swap：vi /etc/fstab 注释掉/swap  重启系统

apt-get update && apt-get install -y apt-transport-https curl
curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | apt-key add -
cat <<EOF >/etc/apt/sources.list.d/kubernetes.list
deb https://apt.kubernetes.io/ kubernetes-xenial main
EOF
apt-get update
apt-get install -y kubelet kubeadm kubectl
```

3、kubeadm init
```
# kubeadm init 以Pod形式拉起 master 组件。
kubeadm init --pod-network-cidr=10.244.0.0/16 #pod分配的ip网段

# master 安装成功后需要，执行以下命令
  mkdir -p $HOME/.kube
  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
  sudo chown $(id -u):$(id -g) $HOME/.kube/config
```

Static Pod
```
kubelet拉起 Static Pod 启动master组件。当kubelet启动时，kubelet --pod-manifest-path=<the directory>，自动创建目录下的所有pod
kubelet 进程 --config参数指定了启动参数，找到staticPodPath字段，
kubelet 会watch配置目录文件的变化，并作出响应。

如何启动Static Pod？ 找到kubelet --pod-manifest-path目录，把自己写的pod yaml文件丢在这个目录下，kubectl会自动创建Static Pod
```




## Node节点
- kubelet
- kube-proxy
- docker
- CNI 插件


同master节点一样安装 kubelet kubeadm kubelet

在master执行，查看kubeadm token
```
kubeadm token list
```

添加node节点命令
```
  kubeadm join 172.24.199.161:6443 --token p0kwhh.kg02s86ge9a0xxk2 --discovery-token-ca-cert-hash  sha256:82d04a08da055d5b8c4da0ebef112c01082081cd10d9ac4e377d187af109b5ec

```
master 节点执行查看node，可以发现已经添加了新的node，但是状态是NotReady
```
kubectl get nodes
```

安装CNI插件，这里用flannel，从官网找地址
```
kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/a70459be0084506e4ec919aa1c114638878db11b/Documentation/kube-flannel.yml
```
master节点执行。会创建DaemonSet对象。意味着node也会自动安装

